from comfy.compliance import high


@high(
    name='rule_cve_2024_20353',
    platform=['cisco_asa', 'cisco_ftd'],
)
def rule_cve_2024_20353(configuration, commands, device):
    """
    Checks if the Cisco ASA or FTD device is vulnerable to the specified CVE
    by looking for an SSL listen socket on any TCP port.

    Args:
        configuration (str): The full device configuration.
        commands (dict): Outputs of the executed commands.
        device: The current device object.

    Returns:
        None. Asserts fail if the device is vulnerable.

    Raises:
        AssertionError: If an SSL listen socket is found, indicating vulnerability.
    """
    ssl_output = device.cli('show asp table socket | include SSL')
    assert 'SSL' not in ssl_output and 'LISTEN' not in ssl_output, \
        "Vulnerable device detected: SSL listen socket in LISTEN status found."
